{% load static %}
<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ site_config.header_logo_text }}</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body>

    <nav id="side-menu" class="side-menu">
        <div class="menu-header">Меню</div>
        <ul>
            {% for item in menu_items %}
            <li><a href="{{ item.link }}">{{ item.text }}</a></li>
            {% endfor %}
        </ul>
    </nav>

    <div class="page-wrapper">
        <header class="main-header">
            <div class="logo">
                {% if site_config.header_logo_image %}
                    <img src="{{ site_config.header_logo_image.url }}" alt="Логотип" class="logo-img" />
                {% else %}
                    {{ site_config.header_logo_text }}
                {% endif %}
            </div>
            <div id="text-carousel" class="carousel-text">
                {% if header_carousel_texts %}<span>{{ header_carousel_texts.0 }}</span>{% endif %}
            </div>
            <div id="menu-toggle" class="menu-toggle"><i class="fa-solid fa-bars"></i></div>
        </header>

<main class="main-content">
    <div id="home" class="hero-content-block" {% if backgrounds.ALIMONY %}style="background-image: linear-gradient(rgba(26, 26, 26, 0.8), rgba(26, 26, 26, 0.8)), url({{ backgrounds.HOME_BANER }});"{% endif %}>
        
        <h1 class="hero-title">{{ hero.title }}</h1>

        <div class="actions">
            <a href="#" id="open-contact-modal-divorce" class="btn btn-outline">{{ hero.button1_text }}</a>
            <a href="#" id="open-contact-modal-alimony" class="btn btn-filled">{{ hero.button2_text }}</a>
        </div>

        <div class="contact-info">
            <a href="tel:{{ hero.phone_number|cut:' ' }}">{{ hero.phone_number }}</a>
        </div>

    </div>

<section id="divorce-info" class="service-section">
    <div class="container">
        <h2 class="section-title">{{ site_config.divorce_section_title }}</h2>
        
        {% if divorce_info %}
        <div class="expandable-text-wrapper">
            <div class="intro-text expandable">
                {{ divorce_info.description|safe }}
            </div>
            <button class="read-more-btn">Розгорнути</button>
        </div>
        {% endif %}

        <h3 class="subsection-title">{{ site_config.packages_subtitle }}</h3>
        <div class="packages-grid">
            {% for service in divorce_services %}
            <div class="package-card">
                <div class="package-card-visible">
                {% if service.label %}
                    <p class="package-label">{{ service.label }}</p>
                {% endif %}
                <h4 class="package-title">{{ service.title|linebreaksbr }}</h4>
                <p class="package-price">{{ service.price|floatformat:"0" }} грн</p>
                </div>
                <div class="package-description-content">{{ service.details|linebreaksbr }}</div>
                <button class="package-read-more" onclick="togglePackageDetails(this)">Детальніше</button>
            </div>
            {% endfor %}
        </div>
        <p class="fee-note">+ 1211,20 грн судовий збір, комісія банку та вартість пересилки документів</p>
    </div>
</section>

<section id="alimony-info" class="service-section" {% if backgrounds.ALIMONY %}style="background-image: linear-gradient(rgba(26, 26, 26, 0.8), rgba(26, 26, 26, 0.8)), url({{ backgrounds.ALIMONY }});"{% endif %}>
    <div class="container">
        <h2 class="section-title">{{ site_config.alimony_section_title }}</h2>
        
        {% if alimony_info %}
            <div class="expandable-text-wrapper">
                <div class="intro-text expandable">
                     {{ alimony_info.description|safe }}
                </div>
                <button class="read-more-btn">Розгорнути</button>
            </div>
        {% endif %}

        <h3 class="subsection-title">{{ site_config.packages_subtitle }}</h3>
        <div class="packages-grid">
            
            {% for service in alimony_services %}
            <div class="package-card">
                <div class="package-card-visible">
                {% if service.label %}
                    <p class="package-label">{{ service.label }}</p>
                {% endif %}
                <h4 class="package-title">{{ service.title|linebreaksbr }}</h4>
                <p class="package-price">{{ service.price|floatformat:"0" }} грн</p>
                </div>
                <div class="package-description-content">{{ service.details|linebreaksbr }}</div>
                <button class="package-read-more" onclick="togglePackageDetails(this)">Детальніше</button>
            </div>
            {% endfor %}
        </div>
        
        {% if site_config.alimony_fee_note %}
            <p class="fee-note">{{ site_config.alimony_fee_note }}</p>
        {% else %}
            <p class="fee-note">+ вартість пересилки документів</p>
        {% endif %}
    </div>
</section>
            
<section id="advantages" class="service-section">
    <div class="container">
        <h2 class="section-title">{{ site_config.advantages_section_title }}</h2>

        <div class="advantages-grid">
            
            {% for advantage in advantages %}
            <div class="advantage-card">
                <div class="advantage-card-visible">
                    <div class="advantage-icon" title="{{ advantage.title }}">
                        <i class="fa-solid {{ advantage.icon_class }}"></i>
                    </div>
                    <h4 class="advantage-title">{{ advantage.title }}</h4>
                </div>
                
                <div class="advantage-description-content">
                    <p>{{ advantage.description }}</p>
                </div>
                
                <button class="advantage-read-more">Детальніше</button>
            </div>
            {% endfor %}

        </div>
    </div>
</section>

<section id="results" class="service-section">
    <div class="container">

        <h2 class="section-title">{{ site_config.results_section_title }}</h2>
        
        <div class="results-grid">
            
            {% for result in results %}
            <a href="{{ result.case_url }}" target="_blank" class="case-card">
                <div class="case-image-wrapper">
                    <img src="{{ result.case_image.url }}" alt="{{ result.title }}">
                </div>
                <h4 class="case-title">{{ result.title }}</h4>
            </a>
            {% endfor %}
            </div>

        <div class="results-button-wrapper">
            <button id="show-all-results-btn" class="btn btn-outline btn-rounded">{{ site_config.results_button_text }}</button>
        </div>
    </div>
</section>

            <section id="testimonials" class="promo-section" {% if backgrounds.TESTIMONIALS %}style="background-image: linear-gradient(rgba(26, 26, 26, 0.8), rgba(26, 26, 26, 0.8)), url({{ backgrounds.TESTIMONIALS }});"{% endif %}>
                <div class="container">
                    <h2 class="section-title">{{ site_config.testimonials_section_title }}</h2>
                    <div class="testimonial-carousel-wrapper">
                        <div class="testimonial-carousel">
                            <div class="testimonial-carousel-track">
                                {% for testimonial in testimonials %}
                                <div class="testimonial-slide">
                                    <p class="testimonial-text">"{{ testimonial.text }}"</p>
                                    <p class="testimonial-author">- {{ testimonial.author }}</p>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        <button class="carousel-button prev"><i class="fa-solid fa-chevron-left"></i></button>
                        <button class="carousel-button next"><i class="fa-solid fa-chevron-right"></i></button>
                        <div class="carousel-dots"></div>
                    </div>
                    <div style="display: flex; justify-content: center; margin: 32px 0 0 0;">
                        <button id="open-testimonial-modal" class="btn btn-filled" style="min-width:260px; font-size:1.15rem;">Залишити відгук</button>
                    </div>
                </div>
            </section>

            <section id="algorithm" class="service-section">
                <div class="container">
                    <h2 class="section-title">{{ site_config.algorithm_section_title }}</h2>
                    <div class="accordion">
                        {% for step in algorithm_steps %}
                        <div class="accordion-item">
                            <button class="accordion-button">
                                <span>{{ step.order }}. {{ step.title }}</span>
                                <i class="fa-solid fa-plus"></i>
                            </button>
                            <div class="accordion-content"><p>{{ step.description|safe }}</p></div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </section>

             <section id="bonuses" class="promo-section" {% if backgrounds.BONUSES %}style="background-image: linear-gradient(rgba(26, 26, 26, 0.8), rgba(26, 26, 26, 0.8)), url({{ backgrounds.BONUSES }});"{% endif %}>
                <div class="container">
                    <h2 class="section-title">{{ site_config.bonuses_section_title }}</h2>
                    <div class="bonus-carousel-wrapper">
                        <div class="bonus-carousel">
                            <div class="bonus-carousel-track">
                                {% for bonus in bonuses %}
                                <div class="bonus-slide">
                                    <div class="bonus-slide-content">
                                        <h4 class="bonus-title">{{ bonus.text }}</h4>
                                        {% if bonus.description %}
                                            <button class="bonus-read-more" onclick="toggleBonusDetails(this)">Детальніше</button>
                                            <div class="bonus-description-content">{{ bonus.description|safe }}</div>
                                        {% else %}
                                            <button class="bonus-read-more" disabled style="opacity:0.5;cursor:not-allowed;">Детальніше</button>
                                        {% endif %}
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        <button class="carousel-button prev"><i class="fa-solid fa-chevron-left"></i></button>
                        <button class="carousel-button next"><i class="fa-solid fa-chevron-right"></i></button>
                        <div class="carousel-dots"></div>
                    </div>
                </div>
            </section>

            <section id="faq" class="service-section">
                <div class="container">
                    <h2 class="section-title">{{ site_config.faq_section_title }}</h2>
                    <div class="accordion">
                        {% for item in faqs %}
                        <div class="accordion-item">
                            <button class="accordion-button">
                                <span>{{ item.question }}</span>
                                <i class="fa-solid fa-plus"></i>
                            </button>
                            <div class="accordion-content"><p>{{ item.answer|safe }}</p></div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </section>

            <section id="contact-section-bg" {% if backgrounds.CONTACT %}style="background-image: linear-gradient(rgba(26, 26, 26, 0.85), rgba(26, 26, 26, 0.85)), url({{ backgrounds.CONTACT }});"{% endif %}>
                <div class="container">
                    <div class="contact-form-card">
                        <h3 class="form-title">{{ site_config.contact_form_title }}</h3>
                        <p class="form-subtitle">{{ site_config.contact_form_subtitle|linebreaksbr }}</p>
                        <form id="contact-form">
                            {% csrf_token %}
                            <div class="form-group">
                                <label for="situation">Опишіть коротко свою ситуацію</label>
                                <textarea id="situation" name="situation" rows="4" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="name">Ваше ім'я</label>
                                <input type="text" id="name" name="name" required>
                            </div>
                            <div class="form-group">
                                <label for="phone">Ваш номер телефону</label>
                                <input type="tel" id="phone" name="phone" required>
                            </div>
                            <button type="submit" class="btn btn-filled">Написати</button>
                        </form>
                        <div class="form-feedback"></div> </div>
                </div>
            </section>
        </main>

        <footer class="main-footer"{% if site_config.footer_background_image %} style="background-image: linear-gradient(rgba(26, 26, 26, 0.85), rgba(26, 26, 26, 0.85)), url('{{ site_config.footer_background_image.url }}'); background-size: cover; background-position: center;"{% endif %}>
            <div class="container">
                <div class="footer-logo">
                    {% if site_config.header_logo_image_footer %}
                        <img src="{{ site_config.header_logo_image_footer.url }}" alt="Логотип" class="logo-img" />
                    {% else %}
                        {{ site_config.footer_logo_text }}
                    {% endif %}
                </div>
                <p class="footer-tagline">{{ site_config.footer_tagline|linebreaksbr }}</p>
                <div class="footer-contacts">
                    <h4 class="footer-heading">{{ site_config.footer_contacts_title }}</h4>
                    <a href="tel:{{ site_config.footer_phone|cut:' ' }}">{{ site_config.footer_phone }}</a>
                    <a href="mailto:{{ site_config.footer_email }}">{{ site_config.footer_email }}</a>
                </div>
                <div class="footer-cta-wrapper">
                    <a href="{{ site_config.footer_cta_link }}" class="footer-cta">{{ site_config.footer_cta_text }}</a>
                </div>
            </div>
        </footer>
    </div>
    
    {{ header_carousel_texts|json_script:"header-carousel-data" }}
    
    <script src="{% static 'js/script.js' %}"></script>
    
    <div class="fab-wrapper">
        <ul class="fab-links">
            <li><a href="https://t.me/your_telegram_username" target="_blank" class="fab-link fab-telegram" title="Telegram"><i class="fa-brands fa-telegram"></i></a></li>
            <li><a href="viber://chat?number=%2B380684114220" target="_blank" class="fab-link fab-viber" title="Viber"><i class="fa-brands fa-viber"></i></a></li>
            <li><a href="tel:+380684114220" class="fab-link fab-phone" title="Подзвонити"><i class="fa-solid fa-phone"></i></a></li>
        </ul>
        <button id="fab-toggle" class="fab-main-button">
            <i class="fa-solid fa-comments icon-open"></i>
            <i class="fa-solid fa-xmark icon-close"></i>
        </button>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        function togglePackageDetails(btn) {
            const card = btn.closest('.package-card');
            // Якщо вже розгорнуто — згортаємо
            if (card.classList.contains('is-expanded')) {
                card.classList.remove('is-expanded');
                btn.textContent = 'Детальніше';
                return;
            }
            // Згортаємо всі інші картки
            document.querySelectorAll('.package-card.is-expanded').forEach(c => {
                c.classList.remove('is-expanded');
                const b = c.querySelector('.package-read-more');
                if (b) b.textContent = 'Детальніше';
            });
            // Розгортаємо поточну
            card.classList.add('is-expanded');
            btn.textContent = 'Згорнути';
        }

        // Плавна прокрутка для якірних посилань меню
        const menuLinks = document.querySelectorAll('.side-menu a[href^="#"], .main-header a[href^="#"]');
        menuLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                const targetId = this.getAttribute('href');
                if (targetId && targetId.startsWith('#') && document.querySelector(targetId)) {
                    e.preventDefault();
                    document.querySelector(targetId).scrollIntoView({ behavior: 'smooth' });
                    // Якщо меню мобільне — закриваємо
                    const menu = document.getElementById('side-menu');
                    if (menu && menu.classList.contains('active')) menu.classList.remove('active');
                }
            });
        });

        // Модалка для відгуку
        const openTestimonialModal = document.getElementById('open-testimonial-modal');
        const testimonialModal = document.getElementById('testimonial-modal');
        const closeTestimonialModal = document.getElementById('close-testimonial-modal');
        if (openTestimonialModal && testimonialModal && closeTestimonialModal) {
            openTestimonialModal.addEventListener('click', () => {
                testimonialModal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
            });
            closeTestimonialModal.addEventListener('click', () => {
                testimonialModal.style.display = 'none';
                document.body.style.overflow = '';
            });
            testimonialModal.addEventListener('click', (e) => {
                if (e.target === testimonialModal) {
                    testimonialModal.style.display = 'none';
                    document.body.style.overflow = '';
                }
            });
        }

        // AJAX для форми відгуку (модалка)
        const testimonialForm = document.getElementById('testimonial-form');
        if (testimonialForm) {
            testimonialForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                const feedback = document.getElementById('testimonial-feedback');
                feedback.textContent = '';
                const btn = testimonialForm.querySelector('button[type="submit"]');
                btn.disabled = true;
                btn.textContent = 'Відправка...';
                const formData = new FormData(testimonialForm);
                try {
                    const response = await fetch(testimonialForm.action, {
                        method: 'POST',
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest',
                            'X-CSRFToken': formData.get('csrfmiddlewaretoken'),
                        },
                        body: formData
                    });
                    const data = await response.json();
                    if (data.status === 'success') {
                        feedback.style.color = 'green';
                        feedback.textContent = data.message;
                        testimonialForm.reset();
                        setTimeout(() => {
                            document.getElementById('testimonial-modal').style.display = 'none';
                            document.body.style.overflow = '';
                            feedback.textContent = '';
                        }, 1800);
                    } else {
                        feedback.style.color = 'red';
                        feedback.textContent = data.message || 'Сталася помилка.';
                    }
                } catch (err) {
                    feedback.style.color = 'red';
                    feedback.textContent = 'Сталася помилка при відправці.';
                }
                btn.disabled = false;
                btn.textContent = 'Надіслати';
            });
        }

        // Модалка для заявки ContactRequest
        const openContactModalDivorce = document.getElementById('open-contact-modal-divorce');
        const openContactModalAlimony = document.getElementById('open-contact-modal-alimony');
        const contactModal = document.getElementById('contact-modal');
        const closeContactModal = document.getElementById('close-contact-modal');
        if (openContactModalDivorce && openContactModalAlimony && contactModal && closeContactModal) {
            openContactModalDivorce.addEventListener('click', function(e) {
                e.preventDefault();
                contactModal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
            });
            openContactModalAlimony.addEventListener('click', function(e) {
                e.preventDefault();
                contactModal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
            });
            closeContactModal.addEventListener('click', function() {
                contactModal.style.display = 'none';
                document.body.style.overflow = '';
            });
            contactModal.addEventListener('click', function(e) {
                if (e.target === contactModal) {
                    contactModal.style.display = 'none';
                    document.body.style.overflow = '';
                }
            });
        }
        // AJAX для форми заявки ContactRequest
        const contactModalForm = document.getElementById('contact-modal-form');
        if (contactModalForm) {
            contactModalForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                const feedback = document.getElementById('contact-modal-feedback');
                feedback.textContent = '';
                const btn = contactModalForm.querySelector('button[type="submit"]');
                btn.disabled = true;
                btn.textContent = 'Відправка...';
                const formData = new FormData(contactModalForm);
                try {
                    const response = await fetch(contactModalForm.action, {
                        method: 'POST',
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest',
                            'X-CSRFToken': formData.get('csrfmiddlewaretoken'),
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            name: formData.get('name'),
                            phone: formData.get('phone'),
                            situation: formData.get('situation')
                        })
                    });
                    const data = await response.json();
                    if (data.status === 'success') {
                        feedback.style.color = 'green';
                        feedback.textContent = data.message;
                        contactModalForm.reset();
                        setTimeout(() => {
                            contactModal.style.display = 'none';
                            document.body.style.overflow = '';
                            feedback.textContent = '';
                        }, 1800);
                    } else {
                        feedback.style.color = 'red';
                        feedback.textContent = data.message || 'Сталася помилка.';
                    }
                } catch (err) {
                    feedback.style.color = 'red';
                    feedback.textContent = 'Сталася помилка при відправці.';
                }
                btn.disabled = false;
                btn.textContent = 'Надіслати';
            });
        }
    });
    </script>

    <!-- Модальне вікно для форми відгуку -->
    <div id="testimonial-modal" class="modal" style="display:none; position:fixed; z-index:10000; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.7); align-items:center; justify-content:center;">
        <div class="modal-content" style="background:#222; padding:32px 24px; border-radius:16px; max-width:400px; width:90vw; margin:auto; position:relative; box-shadow:0 8px 32px rgba(0,0,0,0.3);">
            <button id="close-testimonial-modal" style="position:absolute; top:12px; right:16px; background:none; border:none; color:#fff; font-size:2rem; cursor:pointer;">&times;</button>
            <h3 class="form-title" style="color:#fff; text-align:center;">Залишити відгук</h3>
            <form id="testimonial-form" method="post" action="/api/submit-testimonial/">
                {% csrf_token %}
                <div class="form-group">
                    <label for="testimonial-author" style="color:#fff;">Ваше ім'я</label>
                    <input type="text" id="testimonial-author" name="author" required>
                </div>
                <div class="form-group">
                    <label for="testimonial-text" style="color:#fff;">Ваш відгук</label>
                    <textarea id="testimonial-text" name="text" rows="3" required></textarea>
                </div>
                <button type="submit" class="btn btn-filled">Надіслати</button>
                <div id="testimonial-feedback" style="margin-top:15px;"></div>
            </form>
        </div>
    </div>

    <!-- Модальне вікно для заявки ContactRequest -->
    <div id="contact-modal" class="modal" style="display:none; position:fixed; z-index:10000; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.7); align-items:center; justify-content:center;">
        <div class="modal-content" style="background:#222; padding:32px 24px; border-radius:16px; max-width:400px; width:90vw; margin:auto; position:relative; box-shadow:0 8px 32px rgba(0,0,0,0.3);">
            <button id="close-contact-modal" style="position:absolute; top:12px; right:16px; background:none; border:none; color:#fff; font-size:2rem; cursor:pointer;">&times;</button>
            <h3 class="form-title" style="color:#fff; text-align:center;">Залишити заявку</h3>
            <form id="contact-modal-form" method="post" action="/api/submit-form/">
                {% csrf_token %}
                <div class="form-group">
                    <label for="contact-modal-name" style="color:#fff;">Ваше ім'я</label>
                    <input type="text" id="contact-modal-name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="contact-modal-phone" style="color:#fff;">Ваш телефон</label>
                    <input type="tel" id="contact-modal-phone" name="phone" required>
                </div>
                <div class="form-group">
                    <label for="contact-modal-situation" style="color:#fff;">Опишіть коротко ситуацію</label>
                    <textarea id="contact-modal-situation" name="situation" rows="3" required></textarea>
                </div>
                <button type="submit" class="btn btn-filled">Надіслати</button>
                <div id="contact-modal-feedback" style="margin-top:15px;"></div>
            </form>
        </div>
    </div>

</body>
</html>